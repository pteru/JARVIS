# Sandbox Review: sandbox/20260220-144942

**Date:** 2026-02-20 14:50<br>
**Task:** Implement the /cleanup skill for Claude Code. Create the skill file at .claude/skills/cleanup/SKILL.md following the spec provided. Only implement Phase 1 (Core Skill — Git + Commit). Keep it simple.<br>
**Spec:** backlogs/orchestrator/cleanup-skill.md<br>
**Model:** sonnet<br>
**Branch:** sandbox/20260220-144942<br>
**Base:** develop<br>
**Duration:** 1m 17s<br>
**Exit code:** 0<br>
**Patches:** 1

---

## Commit Log

- `cb6d624` feat: add /cleanup skill for post-task git cleanup ritual

## Diff Summary

```
 .claude/skills/cleanup/SKILL.md             |  131 +++++++++++++++++++++++++++
 changelogs/claude-orchestrator-changelog.md |    5 +
 2 files changed, 136 insertions(+)
```

## Safety Audit

No sensitive files or suspicious patterns detected.

## Full Diff

### Patch: 0001-feat-add-cleanup-skill-for-post-task-git-cleanup-rit.patch

#### `.claude/skills/cleanup/SKILL.md`

```diff
new file mode 100644
index 0000000..2ef4ae6
--- /dev/null
+++ b/.claude/skills/cleanup/SKILL.md
@@ -0,0 +1,131 @@
+---
+name: cleanup
+description: Post-task cleanup — check worktree, stage changes, run checks, commit
+argument-hint: "[workspace-name] (optional — defaults to current directory)"
+---
+
+# Post-Task Cleanup Ritual
+
+Perform the end-of-task cleanup ritual for the current workspace (or the workspace named in the argument).
+
+Work through each step below in order. Present findings as you go so the user can follow along.
+
+---
+
+## Step 1 — Git Status Check
+
+Run `git status` and `git branch -vv` in the working directory. Show:
+- Current branch name
+- Remote tracking status (ahead/behind/untracked remote)
+- Modified files (staged and unstaged, with M/A/D prefix)
+- Untracked files
+
+**Flag if on a default branch** (`main`, `master`, or `develop`) — warn the user that committing directly to this branch may be unintentional.
+
+---
+
+## Step 2 — Branch Analysis
+
+If on a default branch (`main`, `master`, `develop`):
+- Suggest a branch name derived from the changes (e.g., `feat/add-cleanup-skill`)
+- Ask the user: "You are on `<branch>`. Would you like to create a feature branch before committing?"
+- If yes, run: `git checkout -b <suggested-branch>`
+- If no, proceed on the current branch
+
+If already on a feature branch:
+- Confirm the branch name looks appropriate for the work done
+- Note whether it has an upstream tracking branch (`git branch -vv`)
+
+---
+
+## Step 3 — Change Review
+
+Run `git diff --stat HEAD` and `git diff --cached --stat` to summarize all changes. Show:
+- Number of files changed, insertions, deletions
+- List of changed files with their status (modified/added/deleted)
+
+**Flag dangerous files** (do NOT stage these automatically — warn the user):
+- `.env`, `.env.*`, `*.env`
+- `*credentials*`, `*secret*`, `*token*`
+- `*.pem`, `*.key`, `*.p12`, `*.pfx`
+- `*.pyc`, `__pycache__/`, `node_modules/`, `*.egg-info/`, `dist/`, `build/`
+- Files larger than 1MB (check with `git ls-files --others --exclude-standard | xargs ls -la 2>/dev/null`)
+
+If any dangerous files are detected, list them clearly and skip them when staging.
+
+---
+
+## Step 4 — Project Type Detection & Checks
+
+Detect the project type by checking for these files in the working directory:
+
+| File | Type | Linter | Tests |
+|------|------|--------|-------|
+| `pyproject.toml` or `setup.py` | Python | `ruff check .` | `pytest` |
+| `package.json` | Node.js | `npm run lint` (if script exists) | `npm test` (if script exists) |
+| `Cargo.toml` | Rust | `cargo clippy` | `cargo test` |
+| `go.mod` | Go | `golangci-lint run` | `go test ./...` |
+| `platformio.ini` | Firmware | `pio check` | `pio test` |
+
+If a linter is available, run it and show pass/fail. If it fails, show the errors and ask the user whether to fix them before proceeding.
+
+If tests are available, run them and show pass/fail. If tests fail, show the output and ask whether to fix before committing.
+
+If no project type is detected, note "No project type detected — skipping lint and tests."
+
+---
+
+## Step 5 — Commit Preparation
+
+**Stage files:**
+- Run `git add` for all modified and new files EXCEPT the dangerous files flagged in Step 3
+- Show the final list of staged files (`git diff --cached --name-status`)
+
+**Draft a commit message:**
+- Based on the nature of the changes (file names, diff content), draft a concise commit message following conventional commits format: `type: short description`
+- Common types: `feat`, `fix`, `chore`, `docs`, `refactor`, `test`
+- Keep the subject line under 72 characters
+
+**Present for approval:**
+```
+## Ready to Commit
+
+Staged files:
+  <list of staged files>
+
+Proposed commit message:
+  "<drafted message>"
+
+Proceed with commit? [y/n]
+```
+
+If the user approves (y), commit using the heredoc format with Co-Authored-By:
+```bash
+git commit -m "$(cat <<'EOF'
+<message>
+
+Co-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>
+EOF
+)"
+```
+
+If the user declines (n), ask them to provide the correct commit message and use that instead.
+
+---
+
+## Step 6 — Post-Commit Summary
+
+After a successful commit, show:
+- Final git status (should be clean worktree)
+- Number of commits ahead of remote (if tracking branch exists)
+- Reminder: "Run `git push` to push this branch" (if commits are unpushed)
+- If on a feature branch with no PR: "Consider opening a PR with `gh pr create`"
+
+Do NOT push automatically. Leave that to the user.
+
+---
+
+## Argument Handling
+
+- **No argument**: Operate on the current working directory
+- **With workspace name** (e.g., `/cleanup strokmatic.visionking`): Look up the workspace path from `/workspace/config/orchestrator/workspaces.json`, navigate to that path, and perform the cleanup there. If the workspace is not found, inform the user and fall back to the current directory.
```

#### `changelogs/claude-orchestrator-changelog.md`

```diff
index 51254f2..374b619 100644
--- a/changelogs/claude-orchestrator-changelog.md
+++ b/changelogs/claude-orchestrator-changelog.md
@@ -4,6 +4,11 @@ All notable changes to the claude-orchestrator system.
 
 Format: [Keep a Changelog](https://keepachangelog.com/)
 
+## 2026-02-20
+
+### Added
+- `/cleanup` skill — post-task cleanup ritual: git status check, dangerous file detection, project-type-aware lint/test runs, staged commit with user approval, and post-commit push reminder (Phase 1)
+
 ## 2026-02-17
 
 ### Added (email-organizer v1.0.0)
```

---

## Apply Instructions

Patches are at: `/tmp/jarvis-sandbox-20260220-144942-krRjf/`

To apply:
```bash
cd /home/teruel/JARVIS
git am /tmp/jarvis-sandbox-20260220-144942-krRjf/*.patch
```

To discard:
```bash
rm -rf /tmp/jarvis-sandbox-20260220-144942-krRjf
```
